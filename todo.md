# UE5 Tech Tracker（V1）实施计划与依赖关系（基于 PRD）

> 说明：这是一个**无孤立任务**的 WBS（Work Breakdown Structure），从“能离线打开的前端骨架”开始，逐步引入数据模型、抓取、索引、AI、站点生成、Actions 自动化与验收。
> 任务编号：`M1` 为里程碑级任务，子任务：`M1.1`、`M1.1.1`。
> 每个任务都包含 **Deps**（依赖的任务编号），且整个任务图是连通的。

---

## M1 仓库与工程基础（可运行的最小骨架）

**Deps:** 无

* [ ] **M1.1 建立仓库与目录结构**
  **Deps:** 无
  背景：为前端、抓取管线、数据与产物提供稳定路径约定，减少后期迁移成本。

  * [ ] **M1.1.1 创建私有仓库与默认分支**（`main`）
    **Deps:** 无
  * [ ] **M1.1.2 初始化目录骨架**
    **Deps:** M1.1.1
    建议结构：

    * `apps/web/` 前端 SPA
    * `tools/pipeline/` 抓取/构建脚本（Node/Python）
    * `data/items/` Markdown 源数据（每条更新项一个文件）
    * `data/meta/` 版本元数据等
    * `config/` 配置（module/tag/策略）
    * `assets/thumbs/` 缩略图
    * `reports/daily/` 日报
    * `reports/logs/` 构建日志
    * `state/` 增量游标与运行状态（仅仓库可见）
  * [x] **M1.1.3 添加基础文档与运行说明**（README + 架构草图）
    **Deps:** M1.1.2

* [x] **M1.2 工具链与规范**
  **Deps:** M1.1
  背景：统一格式化/校验，保证多人协作与 Actions 自动化稳定。

  * [x] **M1.2.1 前端 lint/format**（ESLint + Prettier + EditorConfig）
    **Deps:** M1.1.2
  * [x] **M1.2.2 Node/Python 代码质量工具**（可选：eslint/ruff）
    **Deps:** M1.1.2
  * [x] **M1.2.3 提交规范**（可选：commitlint）与 CI 基础检查
    **Deps:** M1.2.1

---

## M2 前端离线骨架（file:// 可打开 + 页面框架）

**Deps:** M1

* [x] **M2.1 初始化前端工程（React + Vite + TS）**
  **Deps:** M1.1.2
  背景：PRD 要求离线双击打开，需 SPA + hash 路由。

  * [x] **M2.1.1 创建 Vite React TS 项目**（`apps/web`）
    **Deps:** M1.1.2
  * [x] **M2.1.2 安装依赖**：MUI、Zustand、FlexSearch、路由（HashRouter）
    **Deps:** M2.1.1
  * [x] **M2.1.3 配置基础构建输出目录**（如 `site/` 或 `dist/`）
    **Deps:** M2.1.1

* [x] **M2.2 路由与页面骨架（无数据也能跑通）**
  **Deps:** M2.1
  背景：先把信息架构落地为可访问页面，后续逐步替换为真实数据。

  * [x] **M2.2.1 定义 hash 路由**：`#/`、`#/module/:ms`、`#/item/:id`、`#/search`、`#/favorites`、`#/daily`、`#/logs`
    **Deps:** M2.1.2
  * [x] **M2.2.2 布局组件**：顶栏导航 + 内容区（响应式）
    **Deps:** M2.2.1
  * [x] **M2.2.3 页面占位 UI**（模块目录/模块页/详情/搜索/收藏/日报/日志）
    **Deps:** M2.2.2

* [x] **M2.3 语言显示开关（全站记忆）**
  **Deps:** M2.2
  背景：PRD 规定中英同屏（上中下英）且可切换，需全站状态持久化。

  * [x] **M2.3.1 Zustand store：languageMode（zh/en/both）**
    **Deps:** M2.2.2
  * [x] **M2.3.2 localStorage 持久化与默认值（both）**
    **Deps:** M2.3.1
  * [x] **M2.3.3 UI 控件：顶栏语言切换**（影响所有页面文本渲染）
    **Deps:** M2.3.2

* [x] **M2.4 关键交互骨架（模块页）**
  **Deps:** M2.2
  背景：黄金路径是模块浏览，先把交互容器搭好（20 条 + 无限滚动 + 模块内搜索）。

  * [x] **M2.4.1 模块页：模块内搜索框组件**（仅作用于模块页）
    **Deps:** M2.2.3
  * [x] **M2.4.2 模块页：列表卡片组件（移动端适配）**
    **Deps:** M2.4.1
  * [x] **M2.4.3 无限滚动容器**（IntersectionObserver + “加载中”占位）
    **Deps:** M2.4.2

---

## M3 配置体系（module/tag/抓取策略）与可扩展点

**Deps:** M1, M2

* [x] **M3.1 配置文件结构定义**
  **Deps:** M1.1.2
  背景：PRD 要求你可扩展模块目录与同义词表，且 pipeline 规则可调整。

  * [x] **M3.1.1 定义 `config/module_mapping.yaml`**（最长匹配优先规则）
    **Deps:** M1.1.2
  * [x] **M3.1.2 定义 `config/tag_synonyms.yaml`**（归一化到缩写）
    **Deps:** M1.1.2
  * [x] **M3.1.3 定义 `config/pipeline.yaml`**（上限/阈值/配额/关键词权重模块列表）
    **Deps:** M1.1.2

* [x] **M3.2 前端读取配置（用于 UI 展示与枚举）**
  **Deps:** M3.1, M2.2
  背景：模块目录页需要模块清单；前端应能显示 module_system 目录（可由 config 驱动）。

  * [x] **M3.2.1 构建期将 YAML 转成可 import 的 TS/JS 模块**（避免 file:// fetch）
    **Deps:** M3.1.1
  * [x] **M3.2.2 模块目录页用配置渲染模块列表**（支持你后续新增）
    **Deps:** M3.2.1, M2.2.3

---

## M4 数据模型（Markdown per item）+ 校验 + 稳定 ID

**Deps:** M1, M3

* [x] **M4.1 定义 Front Matter Schema（必填字段 + 类型）**
  **Deps:** M3.1
  背景：源数据是 Markdown，每条更新项必须可校验、可追溯、可重建。

  * [x] **M4.1.1 列出字段与枚举**（change_type、可信度 high/low、ai 标注结构等）
    **Deps:** M3.1.3
  * [x] **M4.1.2 编写 schema（JSON Schema 或自定义校验逻辑）**
    **Deps:** M4.1.1

* [x] **M4.2 Markdown 读写库与模板**
  **Deps:** M4.1
  背景：要稳定写回（利于 git diff），并固定正文结构（Evidence first）。

  * [x] **M4.2.1 选型并封装 front-matter 解析与序列化**
    **Deps:** M4.1.2
  * [x] **M4.2.2 定义正文模板**：Evidence（中英）→ GitHub → AI
    **Deps:** M4.2.1
  * [x] **M4.2.3 写入格式稳定性**（字段排序、缩进、换行风格）
    **Deps:** M4.2.2

* [x] **M4.3 稳定 ID 生成器（内容哈希，不含 title）**
  **Deps:** M4.1
  背景：ID 用于去重/关联缩略图/索引 key；输入为 version + 主URL列表 + github_refs。

  * [x] **M4.3.1 定义 URL 规范化规则**（去 fragment、统一 scheme、去追踪参数等）
    **Deps:** M4.1.2
  * [x] **M4.3.2 实现 hash 计算**（sha256，取前 N 位）
    **Deps:** M4.3.1
  * [x] **M4.3.3 实现“主 URL 选择”接口**（当前规则：按可信度权重最高）
    **Deps:** M4.3.1

* [x] **M4.4 数据校验 CLI**
  **Deps:** M4.2, M4.3
  背景：Actions 构建前后都要能验证 `data/items` 的一致性。

  * [x] **M4.4.1 `validate-items`：遍历并校验 schema**
    **Deps:** M4.1.2
  * [x] **M4.4.2 校验 sources 上限（<=3）与 github_refs 不计入 sources**
    **Deps:** M4.4.1
  * [x] **M4.4.3 校验缺失字段的错误输出（可读日志）**
    **Deps:** M4.4.2

---

## M5 UE 模块映射：Build.cs 扫描 → module_code → module_system

**Deps:** M3, M4

* [ ] **M5.1 Build.cs 扫描器（Engine/Source + Engine/Plugins）**
  **Deps:** M3.1, M4.2
  背景：PRD 要从文件路径推 module_code，再映射到 module_system。

  * [ ] **M5.1.1 通过 GitHub API 列目录树并筛 `*.Build.cs`**
    **Deps:** M3.1.3
  * [ ] **M5.1.2 解析模块名与模块目录**（正则/轻解析，生成映射表）
    **Deps:** M5.1.1
  * [ ] **M5.1.3 输出 `module_map.json`（构建期产物）**
    **Deps:** M5.1.2

* [ ] **M5.2 文件路径 → module_code 归属**
  **Deps:** M5.1
  背景：每条 commit 有文件列表，需推断所属模块（多标签）。

  * [ ] **M5.2.1 给定文件路径，查最近模块目录归属**
    **Deps:** M5.1.3
  * [ ] **M5.2.2 无法映射：module_code=Unknown**
    **Deps:** M5.2.1

* [ ] **M5.3 module_code → module_system（规则映射）**
  **Deps:** M3.1.1, M5.2
  背景：按 `module_mapping.yaml` 最长匹配规则映射到系统模块目录。

  * [ ] **M5.3.1 实现最长匹配优先匹配器**
    **Deps:** M3.1.1
  * [ ] **M5.3.2 输出 module_system 多标签**
    **Deps:** M5.3.1, M5.2.1

---

## M6 GitHub 抓取：ue5-main commits（增量 + 回溯 + 上限）

**Deps:** M3, M4, M5

* [ ] **M6.1 增量状态管理（state/github.json）**
  **Deps:** M4.2
  背景：记录 last_seen_sha；按 PRD 选择“失败也更新 SHA”。

  * [ ] **M6.1.1 定义状态文件结构**（sha、上次运行时间、统计、异常标志）
    **Deps:** M4.2.1
  * [ ] **M6.1.2 读写状态文件（构建期可更新并提交）**
    **Deps:** M6.1.1

* [ ] **M6.2 拉取 commits（REST API）与过滤策略**
  **Deps:** M6.1, M3.1.3
  背景：回溯 50；每日处理最多 200；过滤 message 以 `Merge` 开头。

  * [ ] **M6.2.1 实现从 last_seen_sha 回溯获取 commit 列表**（含回溯窗口）
    **Deps:** M6.1.2
  * [ ] **M6.2.2 过滤 merge commits**（message startsWith "Merge"）
    **Deps:** M6.2.1
  * [ ] **M6.2.3 应用每日上限 200 截断**（记录“数据不完整”事件）
    **Deps:** M6.2.2

* [ ] **M6.3 commit → 更新项（Markdown）生成/更新**
  **Deps:** M4.2, M4.3, M5.2, M5.3
  背景：每个 commit 一条更新项；不做自动合并；github_refs 不计入 sources 上限。

  * [ ] **M6.3.1 解析 commit 元数据**（sha、时间、message、author）
    **Deps:** M6.2.1
  * [ ] **M6.3.2 获取 commit 文件路径列表**（用于详情页与模块映射）
    **Deps:** M6.3.1
  * [ ] **M6.3.3 计算 module_code/module_system**（M5）
    **Deps:** M6.3.2, M5.3.2
  * [ ] **M6.3.4 生成基础 fields**（title/摘要/版本字段占位、change_type 初版规则）
    **Deps:** M6.3.1
  * [ ] **M6.3.5 生成/更新 item Markdown**（Evidence first 模板落地）
    **Deps:** M4.2.2, M4.3.2
  * [ ] **M6.3.6 校验写回结果**（跑 validate-items）
    **Deps:** M4.4.1, M6.3.5

* [ ] **M6.4 SHA 更新策略（失败也更新）+ 回溯去重**
  **Deps:** M6.2, M6.3

  * [ ] **M6.4.1 last_seen_sha 前移到本次看到的最新 sha（无论成功/失败）**
    **Deps:** M6.2.1
  * [ ] **M6.4.2 保留回溯窗口 50 去重逻辑**（基于 item id）
    **Deps:** M4.3.2, M6.3.5

---

## M7 GitHub 补充：PR + Issue 缓存（摘要 + 早期 3 评论）

**Deps:** M6, M4

* [ ] **M7.1 commit → PR 关联与缓存**
  **Deps:** M6.3
  背景：增强动机与讨论，离线缓存标题+描述摘要（≤300词）。

  * [ ] **M7.1.1 通过 API 查 commit 关联 PR**
    **Deps:** M6.3.1
  * [ ] **M7.1.2 缓存 PR 标题 + 描述摘录（≤300词）**
    **Deps:** M7.1.1

* [ ] **M7.2 PR → Issue 关联与缓存**
  **Deps:** M7.1

  * [ ] **M7.2.1 解析 PR 描述中的 Issue 引用**（如 #123）并查询 API
    **Deps:** M7.1.2
  * [ ] **M7.2.2 缓存 Issue 标题 + 描述摘录（≤300词）**
    **Deps:** M7.2.1

* [ ] **M7.3 评论抓取（最早 3，跳过低信息）**
  **Deps:** M7.1, M7.2

  * [ ] **M7.3.1 拉取 PR/Issue 评论时间线**
    **Deps:** M7.1.1
  * [ ] **M7.3.2 低信息过滤规则实现**（<30 字符且无链接/引用/代码块则跳过）
    **Deps:** M7.3.1
  * [ ] **M7.3.3 选取最早 3 条有效评论并写入 github_refs**
    **Deps:** M7.3.2

* [ ] **M7.4 写回 item（github_refs，不计入 sources 上限）**
  **Deps:** M7.1.2, M7.2.2, M7.3.3

  * [ ] **M7.4.1 更新 front matter：github_refs**
    **Deps:** M4.2.1
  * [ ] **M7.4.2 保持 sources<=3 不受影响**
    **Deps:** M4.4.2

---

## M8 Release Notes 版本元数据（权威版本表）

**Deps:** M3, M4

* [ ] **M8.1 抓取版本号/发布日期/Release Notes URL**
  **Deps:** M3.1.3
  背景：模块页默认“最新大版本 x.y”需要权威发布日期序列。

  * [ ] **M8.1.1 定义输出结构**（`data/meta/versions.json`）
    **Deps:** M4.2.1
  * [ ] **M8.1.2 实现抓取器与解析器**（容错 DOM 变化）
    **Deps:** M8.1.1
  * [ ] **M8.1.3 计算“最新大版本 x.y”**（按发布日期）
    **Deps:** M8.1.2

* [ ] **M8.2 版本元数据接入前端**
  **Deps:** M8.1, M2.2

  * [ ] **M8.2.1 构建期将 versions.json 打包为可 import 模块**
    **Deps:** M8.1.2
  * [ ] **M8.2.2 模块页默认版本范围使用“最新大版本 x.y”**
    **Deps:** M8.2.1, M2.4.2

---

## M9 全网检索（Google CSE）+ 证据摘录 + 近重复合并

**Deps:** M3, M4, M11(索引前可先做内容落盘)

* [ ] **M9.1 接入 Google CSE（配额与分页）**
  **Deps:** M3.1.3

  * [ ] **M9.1.1 定义请求预算与分页参数**（150 keywords/day；2 pages/keyword）
    **Deps:** M3.1.3
  * [ ] **M9.1.2 实现查询执行器**（记录每次调用与剩余预算）
    **Deps:** M9.1.1

* [ ] **M9.2 关键词生成（模块权重优先筛选）**
  **Deps:** M6.3, M3.1.3

  * [ ] **M9.2.1 从 commit/PR/ReleaseNotes 抽取候选关键词**（术语/模块/标签/版本）
    **Deps:** M6.3.4
  * [ ] **M9.2.2 候选>150 时按模块权重筛选**（高权重模块优先）
    **Deps:** M3.1.3, M9.2.1

* [ ] **M9.3 抓取页面并生成证据摘录（≤300 词）**
  **Deps:** M9.1, M4.2

  * [ ] **M9.3.1 下载 HTML（仅用于抽取摘录，不做全量保存）**
    **Deps:** M9.1.2
  * [ ] **M9.3.2 段落切分与相关性评分（TF-IDF + 余弦）**
    **Deps:** M4.2.1
  * [ ] **M9.3.3 取 Top3 段拼接并截断到 300 词**
    **Deps:** M9.3.2
  * [ ] **M9.3.4 写入 sources（候选来源，后续按可信度选前 3）**
    **Deps:** M4.4.2

* [ ] **M9.4 近重复合并（0.92）**
  **Deps:** M9.3

  * [ ] **M9.4.1 计算摘录向量（TF-IDF）**
    **Deps:** M9.3.3
  * [ ] **M9.4.2 相似度>0.92 合并并保留转载来源列表**
    **Deps:** M9.4.1

---

## M10 缩略图缓存（og:image → JPEG 统一规格）

**Deps:** M9, M4

* [ ] **M10.1 提取 og:image/twitter:image**
  **Deps:** M9.3.1

  * [ ] **M10.1.1 从 HTML meta 中提取 URL**
    **Deps:** M9.3.1
  * [ ] **M10.1.2 失败时返回空（由前端占位）**
    **Deps:** M10.1.1

* [ ] **M10.2 下载与转码压缩（≤512px、≤200KB、JPEG）**
  **Deps:** M10.1

  * [ ] **M10.2.1 下载图片资源**（处理重定向与超时）
    **Deps:** M10.1.1
  * [ ] **M10.2.2 转码为 JPEG 并缩放**（最长边 512）
    **Deps:** M10.2.1
  * [ ] **M10.2.3 质量/大小控制到 ≤200KB**（迭代降质或二次缩放）
    **Deps:** M10.2.2
  * [ ] **M10.2.4 每条最多 3 张缩略图**（超出截断）
    **Deps:** M10.2.3
  * [ ] **M10.2.5 落盘路径规范**：`assets/thumbs/<item_id>_<n>.jpg`
    **Deps:** M4.3.2

* [ ] **M10.3 前端列表展示（卡片左侧小图）**
  **Deps:** M2.4.2, M10.2

  * [ ] **M10.3.1 卡片组件增加缩略图区域**
    **Deps:** M2.4.2
  * [ ] **M10.3.2 缺失缩略图时显示占位图**
    **Deps:** M10.3.1

---

## M11 AI 能力（分类/benefits/risks/翻译）与标注写回

**Deps:** M4, M6, M9

* [ ] **M11.1 LLM 客户端封装（OpenAI 优先，DeepSeek 备用）**
  **Deps:** M3.1.3

  * [ ] **M11.1.1 统一接口：generate(prompt)->result**（含超时、重试、fallback）
    **Deps:** M3.1.3
  * [ ] **M11.1.2 记录模型与时间戳**（写入 `ai` 字段）
    **Deps:** M11.1.1

* [ ] **M11.2 多标签分类（纯多标签 + 置信度）**
  **Deps:** M6.3, M9.3, M11.1

  * [ ] **M11.2.1 输入拼装**（title/摘要/证据摘录/文件路径/module_code）
    **Deps:** M6.3.2, M9.3.3
  * [ ] **M11.2.2 输出结构定义**（module_system[]/tags[]/confidence）
    **Deps:** M4.1.2
  * [ ] **M11.2.3 低置信度标注规则**（<0.5 仅详情标注）
    **Deps:** M11.2.2

* [ ] **M11.3 benefits 生成（中英）**
  **Deps:** M11.1, M4.2

  * [ ] **M11.3.1 一句话 + 3 要点**（性能/质量/工作流）
    **Deps:** M4.1.2
  * [ ] **M11.3.2 写入 front matter 与正文 AI 区**（标注 AI 生成）
    **Deps:** M4.2.2, M11.1.2

* [ ] **M11.4 risks 生成（中英）**
  **Deps:** M11.1, M4.2

  * [ ] **M11.4.1 注意事项清单 ≤5 条**
    **Deps:** M4.1.2
  * [ ] **M11.4.2 写回并标注 AI 生成**
    **Deps:** M4.2.2, M11.1.2

* [ ] **M11.5 证据摘录翻译（中文）**
  **Deps:** M9.3, M4.2, M11.1

  * [ ] **M11.5.1 翻译策略实现**：保留术语/缩写；类名/路径/代码不翻译；缩写不补全
    **Deps:** M4.2.2
  * [ ] **M11.5.2 写入 Evidence 区（上中文下英文）并标注 AI 翻译**
    **Deps:** M11.5.1

* [ ] **M11.6 写回一致性与校验**
  **Deps:** M11.2, M11.3, M11.4, M11.5, M4.4

  * [ ] **M11.6.1 更新 `ai` 字段（字段级标记/模型/时间）**
    **Deps:** M11.1.2
  * [ ] **M11.6.2 跑 validate-items 确保 schema 合规**
    **Deps:** M4.4.1

---

## M12 重要性打分（P1）规则落地（可解释 + 可配置）

**Deps:** M3, M4, M6, M7, M8

* [ ] **M12.1 P1 规则定义与配置化**
  **Deps:** M3.1.3

  * [ ] **M12.1.1 定义可解释指标**（改动类型/影响范围/来源数量/冲突标志等）
    **Deps:** M4.1.2
  * [ ] **M12.1.2 写入 `config/pipeline.yaml` 或独立 `config/scoring.yaml`**
    **Deps:** M12.1.1

* [ ] **M12.2 P1 计算器实现**
  **Deps:** M12.1, M6.3, M7.4, M8.1

  * [ ] **M12.2.1 从 item 聚合所需特征**（change_type、sources、高可信冲突等）
    **Deps:** M6.3.5, M7.4.1
  * [ ] **M12.2.2 输出 score 与解释字段**（用于前端 tooltip 或日志）
    **Deps:** M12.2.1
  * [ ] **M12.2.3 写入索引字段（不强制写回 Markdown）**
    **Deps:** M12.2.2

---

## M13 索引构建（jieba + FlexSearch）与模块分块（JS import）

**Deps:** M4, M11, M12, M8

* [ ] **M13.1 轻量基础索引生成器（≤50MB）**
  **Deps:** M12.2, M4.2

  * [ ] **M13.1.1 定义基础索引字段集**（标题/摘要/标签/模块/版本/改动类型/发布日期 + 少量摘录）
    **Deps:** M4.1.2
  * [ ] **M13.1.2 生成 `index_base.ts/js` 可 import 模块**（避免 file:// fetch）
    **Deps:** M13.1.1
  * [ ] **M13.1.3 体积监控与失败阈值**（超 50MB 写日志并继续发布）
    **Deps:** M13.1.2

* [ ] **M13.2 中文分词（jieba）**
  **Deps:** M13.1

  * [ ] **M13.2.1 对中文字段分词**（含翻译文本）
    **Deps:** M13.1.1
  * [ ] **M13.2.2 输出 tokens 给 FlexSearch**
    **Deps:** M13.2.1

* [ ] **M13.3 FlexSearch 索引构建与导出**
  **Deps:** M13.2

  * [ ] **M13.3.1 定义字段权重**（标题>摘要>标签）
    **Deps:** M13.1.1
  * [ ] **M13.3.2 构建索引并导出可 import 的 JS 模块**
    **Deps:** M13.3.1

* [ ] **M13.4 按模块分块导出详情数据（dynamic import）**
  **Deps:** M4.2, M8.1

  * [ ] **M13.4.1 为每个 module_system 生成 `chunk_<ms>.ts/js`**
    **Deps:** M3.1.1
  * [ ] **M13.4.2 chunk 内容包含详情页所需完整字段**（Evidence/GitHub/AI/paths/thumbs）
    **Deps:** M4.2.2, M10.2.5

---

## M14 前端接入真实数据（模块浏览闭环）

**Deps:** M2, M13, M8, M12

* [ ] **M14.1 模块目录页：真实模块统计**
  **Deps:** M13.1, M3.2

  * [ ] **M14.1.1 从基础索引聚合模块数量/最近更新时间**
    **Deps:** M13.1.2
  * [ ] **M14.1.2 模块卡片渲染（可点击进入模块页）**
    **Deps:** M2.2.3, M14.1.1

* [ ] **M14.2 模块页：默认最新大版本 + 20 条 + 无限滚动**
  **Deps:** M8.2, M13.4, M2.4

  * [ ] **M14.2.1 计算模块页默认版本过滤（x.y）**
    **Deps:** M8.1.3
  * [ ] **M14.2.2 加载模块 chunk 并过滤到 x.y**
    **Deps:** M13.4.2
  * [ ] **M14.2.3 按 P1 排序，首屏 20，滚动加载后续**
    **Deps:** M12.2.3, M2.4.3

* [ ] **M14.3 模块页内搜索（标题/摘要/标签）**
  **Deps:** M14.2, M2.4.1

  * [ ] **M14.3.1 实现本地过滤/评分（仅三字段）**
    **Deps:** M13.1.2
  * [ ] **M14.3.2 搜索结果与无限滚动协同**（搜索时重置分页窗口）
    **Deps:** M14.3.1

* [ ] **M14.4 详情页：Evidence/GitHub/AI/文件路径/缩略图**
  **Deps:** M13.4, M10.3, M11.6

  * [ ] **M14.4.1 按 id 加载所属模块 chunk 并定位 item**
    **Deps:** M13.4.2
  * [ ] **M14.4.2 Evidence 卡片渲染（中文在上、英文在下）**
    **Deps:** M2.3.3, M11.5.2
  * [ ] **M14.4.3 GitHub 区渲染（PR/Issue 摘要+评论）**
    **Deps:** M7.4.1
  * [ ] **M14.4.4 文件路径列表（前 30 + “还有 X”）**
    **Deps:** M6.3.2
  * [ ] **M14.4.5 缩略图展示与占位**
    **Deps:** M10.3.2

---

## M15 全局搜索接入（重要性优先排序）

**Deps:** M14, M13, M12

* [ ] **M15.1 搜索页接入 FlexSearch**
  **Deps:** M13.3

  * [ ] **M15.1.1 搜索输入与 debounce**
    **Deps:** M2.2.3
  * [ ] **M15.1.2 调用索引查询并返回候选集合**
    **Deps:** M13.3.2

* [ ] **M15.2 结果卡片字段与高亮片段**
  **Deps:** M13.1

  * [ ] **M15.2.1 卡片字段：标题摘要、版本&日期、模块、改动类型、可信度、命中片段**
    **Deps:** M13.1.1
  * [ ] **M15.2.2 命中高亮（从 ≤300 摘录截取）**
    **Deps:** M15.1.2

* [ ] **M15.3 排序：重要性 P1 优先**
  **Deps:** M12.2

  * [ ] **M15.3.1 将 P1 score 作为首排序键**
    **Deps:** M12.2.3
  * [ ] **M15.3.2 同分再按匹配度（可选）**
    **Deps:** M15.1.2

---

## M16 收藏功能（localStorage，时间倒序）

**Deps:** M14

* [ ] **M16.1 收藏数据结构与 API**
  **Deps:** M2.1.2

  * [ ] **M16.1.1 localStorage 存 `{id, ts}`**
    **Deps:** M2.3.2
  * [ ] **M16.1.2 收藏/取消收藏操作封装**
    **Deps:** M16.1.1

* [ ] **M16.2 详情页收藏按钮接入**
  **Deps:** M14.4

  * [ ] **M16.2.1 详情页按钮与状态同步**
    **Deps:** M16.1.2

* [ ] **M16.3 收藏页列表（时间倒序）**
  **Deps:** M16.1, M13.1

  * [ ] **M16.3.1 按 ts 倒序渲染**
    **Deps:** M16.1.1
  * [ ] **M16.3.2 从基础索引补齐标题/摘要等展示字段**
    **Deps:** M13.1.2

---

## M17 日报生成与展示（按模块、每模块 10 条）

**Deps:** M12, M8, M4, M14

* [ ] **M17.1 日报生成器（构建期）**
  **Deps:** M12.2, M4.2

  * [ ] **M17.1.1 定义“当天新增/更新条目”的判定**（按抓取时间或 commit 时间）
    **Deps:** M6.3.1
  * [ ] **M17.1.2 按 module_system 分组并取 P1 前 10**
    **Deps:** M12.2.3
  * [ ] **M17.1.3 输出 `reports/daily/YYYY-MM-DD.md`**
    **Deps:** M17.1.2

* [ ] **M17.2 日报页展示**
  **Deps:** M2.2.3, M17.1

  * [ ] **M17.2.1 读取日报产物并渲染模块分组**
    **Deps:** M17.1.3

---

## M18 构建日志与“数据不完整”提示（前台可追溯）

**Deps:** M6, M9, M10, M11, M13, M14

* [ ] **M18.1 统一日志事件结构与写入**
  **Deps:** M1.1.2

  * [ ] **M18.1.1 定义 `reports/logs/index.json` 结构**（每次构建一条摘要+样例错误）
    **Deps:** M1.1.2
  * [ ] **M18.1.2 每个 pipeline step 写入日志**（GitHub/Release/CSE/Thumb/AI/Index/Web）
    **Deps:** M18.1.1

* [ ] **M18.2 首页仅显示最近一次构建状态**
  **Deps:** M2.2.3, M18.1

  * [ ] **M18.2.1 首页状态条：成功/失败/截断/配额耗尽**
    **Deps:** M18.1.2
  * [ ] **M18.2.2 “数据可能不完整”条件**（>200 commit 截断等）
    **Deps:** M6.2.3

* [ ] **M18.3 日志页展示（摘要 + 展开样例）**
  **Deps:** M2.2.3, M18.1

  * [ ] **M18.3.1 渲染构建列表**（时间、步骤、错误数）
    **Deps:** M18.1.2
  * [ ] **M18.3.2 展开显示前 20 条错误样例**
    **Deps:** M18.3.1

---

## M19 GitHub Actions 端到端自动化（UTC 0:00，部分失败也发布）

**Deps:** M6, M7, M8, M9, M10, M11, M12, M13, M17, M18, M14, M15, M16

* [ ] **M19.1 Actions workflow 基础**
  **Deps:** M1.1.1

  * [ ] **M19.1.1 定义 schedule（UTC 0:00）+ workflow_dispatch**
    **Deps:** M1.1.1
  * [ ] **M19.1.2 定义 Secrets 清单**（PAT/OpenAI/DeepSeek/CSE Key/cx）
    **Deps:** M19.1.1

* [ ] **M19.2 运行脚本编排（pipeline 主入口）**
  **Deps:** M6, M7, M8, M9, M10, M11, M12, M13, M17, M18

  * [ ] **M19.2.1 编写 `tools/pipeline/run.ts|py` 主入口**（按阶段执行并捕获错误）
    **Deps:** M18.1.2
  * [ ] **M19.2.2 实现“部分失败也发布”**（单阶段失败不中断全局；写日志）
    **Deps:** M19.2.1

* [ ] **M19.3 构建站点与提交产物（GITHUB_TOKEN）**
  **Deps:** M2.1.3, M13, M14

  * [ ] **M19.3.1 Actions 中构建前端产物**（Vite build）
    **Deps:** M2.1.3
  * [ ] **M19.3.2 提交生成内容回仓库**（只用 `GITHUB_TOKEN` 写入）
    **Deps:** M19.3.1

* [ ] **M19.4 验证离线可用性**
  **Deps:** M19.3

  * [ ] **M19.4.1 本地 `git pull` 后双击 `index.html` 可用**（无 fetch/CORS 问题）
    **Deps:** M19.3.2

---

## M20 端到端验收（黄金路径 + 异常路径）

**Deps:** M19

* [ ] **M20.1 黄金路径验收：模块浏览**
  **Deps:** M14

  * [ ] **M20.1.1 模块目录 → 模块页（最新大版本）→ 搜索 → 详情**（Evidence/文件路径/来源齐全）
    **Deps:** M14.4

* [ ] **M20.2 搜索验收：全局搜索（重要性优先）**
  **Deps:** M15

  * [ ] **M20.2.1 搜索关键术语 → 结果卡片字段完整 → 进入详情**
    **Deps:** M15.2

* [ ] **M20.3 收藏验收**
  **Deps:** M16

  * [ ] **M20.3.1 收藏后刷新页面仍存在；收藏页时间倒序**
    **Deps:** M16.3

* [ ] **M20.4 日报验收**
  **Deps:** M17

  * [ ] **M20.4.1 日报按模块分组、每模块 ≤10、按 P1 排序**
    **Deps:** M17.2.1

* [ ] **M20.5 异常可追溯验收（部分失败也发布）**
  **Deps:** M18, M19

  * [ ] **M20.5.1 模拟 CSE key 失效：站点仍发布；首页提示异常；日志页可见样例**
    **Deps:** M18.3.2, M19.2.2
  * [ ] **M20.5.2 模拟 commit>200 截断：首页提示“数据可能不完整”**
    **Deps:** M6.2.3, M18.2.2

---

## M21 文档化与交付（面向开发/维护）

**Deps:** M20

* [ ] **M21.1 开发者文档**
  **Deps:** M20

  * [ ] **M21.1.1 README：本地运行/构建/调试 pipeline**
    **Deps:** M19.4.1
  * [ ] **M21.1.2 配置手册：module_mapping/tag_synonyms/scoring**
    **Deps:** M3.1, M12.1.2

* [ ] **M21.2 运维文档（Actions）**
  **Deps:** M19

  * [ ] **M21.2.1 Secrets 说明与最小权限原则**（PAT 只读 UE；写入用 GITHUB_TOKEN）
    **Deps:** M19.1.2, M19.3.2
  * [ ] **M21.2.2 常见失败排查**（看 `reports/logs/index.json` 与首页提示）
    **Deps:** M18.3.2

---

## 依赖关系摘要（无孤立任务）

* **基础**：M1 → M2/M3/M4
* **数据能力主干**：M3+M4 → M5 → M6 → M7
* **版本元数据**：M3+M4 → M8 → M14
* **社区补充**：M3+M4 → M9 → M10
* **AI**：M4+M6+M9 → M11
* **打分与索引**：M6/M7/M8 + M11 → M12 → M13
* **前端闭环**：M2 + M13 + M8 + M12 → M14 → M15/M16
* **日报与日志**：M12+M14 → M17；各 pipeline → M18
* **自动化**：M6..M18 + M14..M16 → M19 → M20 → M21
