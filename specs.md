# UE5 Tech Tracker（V1）产品需求文档（PRD）

> 产品形态：离线静态 Web 站点（双击 `index.html` 即可用），面向技术美术与渲染工程师，用于按模块浏览 UE5 版本更新（从 5.0 起到最新），并提供可追溯的来源证据与代码定位信息。

---

## 1. 项目概述

### 1.1 背景
UE5 从 5.0 起迭代频繁，技术美术/渲染工程师在学习与调研时需要：
- 快速按**模块**（如 Lumen/Nanite/渲染/RHI/材质等）理解“有什么变化”
- 能定位到**引擎源码文件路径**、相关 **commit/PR/Issue** 证据
- 能看到外部资料（社区/博客/课程等）与实际案例，并保留引用链路

### 1.2 目标
- 以“模块浏览”为黄金路径，保证用户能快速找到目标更新项，并进入详情查看证据与代码位置（V1 第一优先级：**检索与可用性**）。
- 每条信息必须展示：**来源 + 引用链接 + 证据摘录**；支持冲突展示与“待确认”标注。
- 自动化抓取与增量更新：**每日一次**，生成静态站点与日报。

### 1.3 非目标（V1 明确不做）
- 不做“版本对比视图”和“模块演进视图”（可预留到 V2）。
- 不做深链接（URL 复现页面状态）。
- 不提供“术语解释区”，UI 只显示缩写标签，不补全全称。

### 1.4 关键名词
- **PR（Pull Request）**：一组代码改动的合并请求，通常包含更完整的动机说明与讨论。
- **Issue**：问题/任务单，可追踪 bug、需求、讨论与最终修复链路。
- **GitHub Actions**：GitHub 的 CI/自动化执行环境，用于定时抓取、生成并提交站点。
- **`GITHUB_TOKEN`**：Actions 运行时自动提供的仓库令牌，用于对“当前仓库”安全地执行读写操作。
- **PAT（Personal Access Token）**：个人访问令牌，用于访问私有资源（本项目仅用于读取 Epic 私有 UnrealEngine 仓库与 API）。

---

## 2. 核心需求

### 2.1 内容范围
- UE 版本范围：**UE5.0 → 最新**
- 关注分支：只关注主分支开发（`ue5-main`）为核心证据链
- Hotfix：
  - 需要展示 x.y.z（hotfix）版本信息
  - Git 证据补齐以 **tag 为准**；若找不到精确 tag：该 hotfix 的 Git 证据可跳过，保留 Release Notes/外部来源并标注

### 2.2 内容呈现要求
- 每条更新项必须展示：
  - 来源链接（最多 3 个 sources）
  - 每个来源的证据摘录（≤300 英文词），并提供中文翻译（标注 AI 翻译）
  - AI 解读（好处/风险/摘要等）需要明确标注“AI 生成/推断”
- 冲突处理：
  - 高可信来源之间冲突：**不裁决**，并排展示来源卡片并标注“高可信冲突/待确认”
  - 列表页不额外显示“冲突”标记（仅详情页体现）

### 2.3 可用性与性能（V1）
- 使用方式：离线 `file://` 打开，无服务器
- 默认信息密度：中等（文档站 + 卡片）
- 桌面端（Chrome/Edge 最新版）冷启动可交互：≤5 秒
- 基础索引大小上限：≤50 MB（不做 gzip/brotli 前端解压）
- 模块页默认只看**最新大版本 x.y**（忽略 hotfix）
- 模块页首屏 20 条，无限滚动加载

### 2.4 数据可信度分级（2 档）
- **高可信**：
  - Epic GitHub commit / PR / Issue
  - Epic Release Notes
  - Epic 官方文档/技术文章/博客
  - Epic 官方示例项目说明
  - Epic 官方论坛
  - 第三方博客/课程整理
- **低可信**：
  - 社区平台：知乎 / Reddit / 其它社区论坛等
- 列表页可信度标签显示规则：只要存在高可信来源即标“高”

### 2.5 自动化抓取与更新频率
- GitHub Actions：每日 UTC 0:00 运行
- 增量抓取：每日增量 + 回溯窗口（50 commits）去重
- 允许漏抓（已接受）：  
  - 失败也更新 SHA  
  - 每日最多处理 200 commits，超出直接跳过  
  - 站点首页显示“数据可能不完整”提示（仅展示最近一次构建状态）

---

## 3. 核心功能

### 3.1 模块浏览（黄金路径）
- 模块目录页（module_system）→ 模块详情页 → 更新项详情
- 模块页默认：
  - 最新大版本 x.y
  - 首屏 20 条
  - 无限滚动
  - 主过滤入口：模块页内搜索框（默认搜索：标题+一句话摘要+标签）
- 排序：
  - 默认按版本倒序，同版本内按“重要性规则打分（P1）”
  - **待定**：模块页内搜索后的排序（需最终确认）

### 3.2 全局搜索
- 基础索引为轻量索引（字段：标题/摘要/标签/模块/版本/改动类型/发布日期 + 少量摘录）
- 结果卡片默认显示：标题摘要、版本&发布日期、模块、改动类型、可信度标签、命中高亮片段
- 排序：重要性 P1 优先

### 3.3 更新项详情页（Evidence First）
- 页面结构：证据（来源卡片）→ GitHub 引用（commit/PR/Issue）→ AI 解读区
- 来源卡片：
  - 默认显示 300 词英文摘录 + 中文翻译（上中文下英文）
  - 不过滤代码块（原样保留）
- 文件路径列表：
  - 默认显示前 30 条，超过则提示“还有 X 个文件”
  - 排序：字母序
- 冲突展示：
  - 高可信冲突 → 并排来源卡片（每卡包含摘录），不生成“冲突要点”

### 3.4 收藏
- 存储：浏览器 `localStorage`
- 收藏列表：按收藏时间倒序

### 3.5 日报（每日生成）
- 结构：按模块分组
- 每模块最多 10 条，取重要性 P1 前 10
- 离线查看：仓库内 Markdown 文件 + 站内入口

### 3.6 日志与异常可追溯
- 构建失败策略：部分更新也发布
- 站内日志页：
  - 每次构建摘要记录（时间、成功/失败、失败步骤、失败数量）
  - 可展开查看前 20 条错误样例
- 首页异常提示：
  - 仅展示最近一次构建状态（失败/截断/配额耗尽等）

---

## 4. 核心组件

### 4.1 数据源层
1) **Epic Release Notes / What’s New**
- 用作版本元数据权威入口（版本号、发布日期、Release Notes 链接）

2) **Epic GitHub（UnrealEngine 私有仓库）**
- 获取 `ue5-main` commits + 关联 PR/Issue 元数据（通过 GitHub REST API）

3) **全网英文检索（社区案例/文章）**
- Google Programmable Search / Custom Search JSON API：每日 300 次调用、150 关键词、每词 2 页（20 条）

4) **媒体缩略图**
- 仅抓取 `og:image/twitter:image`，转码压缩为 JPEG 缩略图（≤512px、≤200KB）

### 4.2 数据处理层（构建期）
- 去噪：轻度规则（不限制域名重复）
- 近重复合并：TF-IDF + 余弦相似度阈值 0.92（均衡）
- 段落相关性抽取：TF-IDF 余弦相似度，取 Top 3 段拼接到 300 词上限
- 分类（AI）：
  - 纯多标签输出（模块集合 + 标签集合，带置信度）
  - 置信度 < 0.50：仅在详情标注“低置信度”，不改列表排序
- 社区内容未写版本号：不推断版本，标“版本未知”，只归模块/技术点

### 4.3 存储层（源数据）
- 源数据：Markdown（每条更新项一个文件）
- 路径：`data/items/<item_id>.md`
- Front Matter（必填字段）：
  - `id`（内容哈希：不包含 title；由 version + 主URL列表 + github_refs 规范化后 hash）
  - `title`
  - `version`
  - `module_system`（多标签）
  - `module_code`（多标签）
  - `change_type`
  - `tags`
  - `sources`（最多 3 个；超出保留可信度最高的前 3 个）
  - `github_refs`（commit/PR/Issue/tag 等；不计入 sources 上限）
  - `ai`（哪些字段 AI 生成/推断 + 模型 + 时间戳）
  - `benefits`（一句话 + 3 要点：性能/质量/工作流）
  - `risks`（注意事项清单，最多 5 条）

### 4.4 索引与搜索
- 分词：jieba（中文分词，构建期）
- 全文索引：FlexSearch（前端离线搜索）
- 分块（chunking）：按模块分块
- 基础索引：常驻（≤50MB），详情按模块懒加载

### 4.5 前端呈现层
- 静态 SPA（file:// 可用）
- 模块目录/模块页/详情页/全局搜索/收藏/日报/日志
- 语言显示：
  - 上中文下英文
  - 全站开关（中文/英文/中英），默认中英，localStorage 记忆
  - 证据摘录：中文翻译策略为“保留英文术语与缩写；类名/路径/代码不翻译；缩写不补全”

### 4.6 配置与可扩展
- `config/module_mapping.yaml`：`module_code → module_system` 规则表（最长匹配优先）
- `tag_synonyms.yaml`：标签归一化到缩写（UI 只显示缩写）

---

## 5. 应用/用户流程（User Flow）

### 5.1 黄金路径：模块浏览（V1 主流程）
1. 打开站点（离线）  
2. 进入模块目录（module_system）  
3. 选择模块（例如 Lumen / Nanite / 渲染总览）  
4. 默认看到最新大版本 x.y 的前 20 条更新项（按重要性 P1 排序）  
5. 使用模块页内搜索（标题+摘要+标签）缩小范围  
6. 打开更新项详情  
7. 查看：
   - 来源与证据摘录（中英）
   - GitHub 引用（commit/PR/Issue）与文件路径列表（前 30 + 提示）
   - AI 解读：好处（性能/质量/工作流）与风险清单（≤5）  
8. 可收藏该更新项

### 5.2 辅助流程：全局搜索
- 输入关键词 → 查看结果卡片 → 进入详情页 → 证据/代码定位 → 收藏

### 5.3 运行维护流程（自动化）
- 每日 UTC 0:00 Actions 运行：
  1) 拉取版本元数据（Release Notes）  
  2) 增量拉取 `ue5-main` 提交（上次 SHA + 回溯 50；每日上限 200，超出跳过）  
  3) 拉取 PR/Issue 摘要与评论（最早 3 条，跳过低信息评论 <30 字符）  
  4) 生成/更新更新项 Markdown  
  5) 全网检索补充案例（150 关键词、每词 20 条）  
  6) 缩略图抓取与转码  
  7) 构建索引与静态站点  
  8) 提交回仓库（写入使用 `GITHUB_TOKEN`；读取 UnrealEngine 使用 PAT）

---

## 6. 技术栈

### 6.1 前端
- React + Vite（SPA 构建）
- MUI（组件库）
- Zustand（状态管理）
- FlexSearch（离线全文检索）

### 6.2 构建与数据处理（GitHub Actions / Node / Python）
- GitHub Actions（定时任务、构建与提交）
- GitHub REST API：commits / PR / issues
- Google Custom Search JSON API（全网检索）
- jieba（中文分词，构建期）
- 图片处理：构建期转码压缩（JPEG 输出）

### 6.3 AI（内容生成与翻译）
- 模型路由：OpenAI 优先，DeepSeek 备用
- AI 任务：多标签分类、好处/风险生成、证据翻译（均需“AI 生成/推断”标注）

---

## 7. 实施计划（里程碑交付）

> 按“可验收产物”分阶段推进。

### 里程碑 M1：仓库骨架与离线可运行前端
- 初始化：React + Vite + MUI + Zustand
- 完成页面骨架：模块目录 / 模块页 / 详情页 / 搜索页 / 收藏页 / 日志页 / 日报页
- 完成离线打开策略：数据编进 JS bundle（避免 file:// fetch JSON 问题）

### 里程碑 M2：数据模型与源数据落盘（Markdown）
- 定义 Front Matter schema 与正文模板（Evidence first）
- 实现 item_id（内容哈希）生成与 sources 选前三逻辑
- 实现 `module_mapping.yaml` 与 `tag_synonyms.yaml` 读取与生效

### 里程碑 M3：GitHub（ue5-main）增量抓取与证据链
- GitHub REST API 拉取 commits（增量 SHA + 回溯 50 + 去重）
- 每日上限 200 + 超限截断策略 + 首页“数据不完整”提示
- 关联 PR/Issue：获取摘要 + 评论（最早 3，跳过低信息 <30 字符）
- 从 commit diff 提取文件路径（展示前 30 + “还有 X 个文件”）

### 里程碑 M4：Release Notes 版本元数据与模块页默认视图
- 抓取版本元数据（版本号、发布日期、Release Notes 链接）作为权威来源
- 模块页默认只展示最新大版本 x.y

### 里程碑 M5：全网检索补充案例 + 缩略图缓存
- Google CSE：关键词自动抽取 + 150 关键词/天 + 每词 2 页
- 去噪与近重复合并（TF-IDF 0.92）
- `og:image` 抓取与 JPEG 缩略图转码；失败占位与日志记录

### 里程碑 M6：索引与搜索质量
- 构建轻量索引（≤50MB）+ 模块分块详情数据
- FlexSearch 搜索与高亮片段
- 重要性打分 P1 排序落地（规则可解释、可配置）

### 里程碑 M7：AI 生成内容与中英呈现
- 生成 benefits（性能/质量/工作流）与 risks（≤5）
- 证据摘录翻译（上中文下英文），全站语言开关与 localStorage 记忆
- AI 标注规范与落地（字段级）

### 里程碑 M8：GitHub Actions 端到端自动化与可追溯
- UTC 0:00 定时运行
- `GITHUB_TOKEN` 提交站点结果；PAT 仅用于读取 UnrealEngine/API
- 失败部分发布 + 前台日志页与首页提示

---

## 待确认事项（会影响实现细节）
1) 模块页内搜索后的排序：P1 还是匹配度优先（当前未定）。  
2) 外部页面语言检测：是否只收英文页面（当前未定）。  
3) “高可信内部权重”的量化（用于主 URL 选择的细化规则，目前仅有“高/低”档）。  
